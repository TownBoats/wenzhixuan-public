# 开发日志

## 2025年1月26日

### 今日成果

- [x] 实现 agent 类，可以控制提示词、参数
- [x] 创建一个对话示例
- [x] 美化对话网页

### 明日任务

- [ ] 完善初步对话流程 demo
- [ ] 思考提示工程
    - [ ] 如何得到质量好的回答
    - [ ] 如何得到结构化的回答
- [ ] 实现 AI 互相对话注入
- [ ] 实现简单的流程展示

## 2025年1月31日

### 今日成果

- [x] 完善初步对话流程 demo
- [x] 思考提示工程
    - [x] 如何得到质量好的回答
    - [x] 如何得到结构化的回答
    - [x] 生成了主ai和提问ai的prompt
- [x] 使用反引号存储prompt，并单独存放在一个js文件中

### 明日任务
- [] 实现 AI 互相对话注入
- [] 实现简单的流程展示

## 2025年2月1日

### 今日成果

- [] 实现 AI 互相对话注入
    - [x] 如何提取对话内容-收集一下就行了
    - [x] 如何提取指定标签内容-构建了一个标签提取器


## 2025年2月3日
### 今日进度
- [x] 做了ui界面，但是只有demo
- [x] 完成prompt的注入，现在实现了主ai的内容向question ai的注入，但是延迟比较高

### 下一步任务
- [ ] 把整个数据流的流动都做完整，包含问题ai的数据提取，数据注入到内容message中，进行下一轮对话
- [ ] 优化延迟问题，理清楚数据处理和解析的边界—最好能实现一边解析标签，解析完一个完整内容就进行提问
- [ ] 将数据流和ui界面融合起来

## 2025年2月4日
### 今日进度
- [x] 完成了基础的数据流，从控制台可以进行稍微顺畅的对话了（笑）

### 下一步任务
- [ ] 重构对话方式，对话内容仅显示response的内容
- [ ] 将question和response区分显示
- [ ] 将question的回复内容展示出来，可以通过点击进行对话

### 首要问题
- [x] 流式输出是分块儿的，每获取一块儿就会更新一下内容，导致目前解析起来有问题，更新过于频繁。导致输出冗余
- [x] 需要设计一个方案
  - [x] 流式输出可以被实时解析标签
  - [x] 当解析到一个结束标签的时候返回一个信号，进行解析
  - [x] 解析后更新变量
- [x] 升级解析器

## 2025年2月16日
### 完成的内容
- [x] 完成了上面的首要问题，升级了解析器，也完成了大部分的数据流，ui-messages的数据完成了大部分

### 问题
- [ ] ui不完善，目前的ui很简陋，并且缺少question-answer-card的展示与交互
- [ ] 数据流有问题，ui-message还不完善，缺少question-answer的数据流动与下一步的数据流动
- [ ] 没有(true)messages的数据流

### 下一步任务
- [x] 创建question卡片、answer卡片
- [x] 完善answer卡片的交互
- [x] 梳理完整的ui-message的数据流
  - [x] 包含上下文的数据流（算是完善了）
- [ ] 开发完整的ui-message的数据流
- [ ] 梳理开发(true)messages的数据流

## 2025年2月17日
### 完成的内容
- [x] 创建question卡片、answer卡片
- [x] 完善answer卡片的交互
- [x] 梳理完整的ui-message的数据流
- [x] 将answer卡片融入了整个交互

### 问题
- [ ] 对于cursor的依赖太过头了，对于代码的实现细节和具体的参数、状态值情况其实很茫然，如果是作为自己的项目开发，感觉不太健康
- [x] ui-messages的数据流基本完成，(true)messages的数据流细节需要自己看代码来写
- [ ] 刚刚测试，发现ai会不按照指定的格式（标签内容）来输出内容，导致解析失败，可能需要重新设计prompt，也可能是因为上下文太长了

### 下一步任务
- [x] 梳理(true)messages的数据流，并且同时查看ui-messages的数据流动情况

## 2025年2月18日
### 完成的内容
- [x] ui-messages的数据流基本完成，(true)messages的数据流细节需要自己看代码来写
- [x] 梳理(true)messages的数据流，并且同时查看ui-messages的数据流动情况
- [x] 将点击卡片后的完整问题和回答输出到了控制台上
- [x] 添加了火山的api
- [x] env文件的配置更简单了

### 问题
- [ ] 问题卡片弹出太慢了，目前是等待解析完成后再弹出，应该可以先弹出，再解析内容

### 下一步任务
- [ ] 对于回答卡片的具体操作，设计流程
- [ ] 将数据流实装到交互中
- [ ] 研究探索除了核心功能，外围的功能如何实现（例如调整prompt、历史记录、自定义api、调整模型参数等）
- [ ] 整理文档文件，梳理结构，删除无用内容

## 2025年2月19日
### 完成的内容
- [x] 回答卡片做出了手动回答的内容
- [x] 统一了设计风格
- [x] 增加了一个科技主题
- [x] 添加问题等待时的过度
- [x] 实现先加载框架再填充内容
- [x] 实现问题卡片点击时的流式输出
- [x] 添加非首轮ai回答的调试信息
- [x] 优化问题回答的异步操作
- [x] 点击问题卡片回答以后，ui-messages没有逐步输入增加内容，导致都是最后一次性增加的，如果对话过长，会显著增加延迟
- [x] 问题卡片弹出太慢了，目前是等待解析完成后再弹出，应该可以先弹出，再解析内容
- [x] 问题ai也需要上下文，否则会出现牛头不对马嘴的情况

### 问题
- [ ] 使用单一的回答模板，不能做出合适的回答，对于不同情况的问题，仅仅靠"5种掌握程度"不能做出合适的回答。可能需要根据不同的问题来区分
  - [ ] 疑问句--提出几个概念，询问是否了解
  - [ ] 是否有兴趣--"你是否有兴趣了解高数中的某个具体主题，比如极限、导数或者积分？"
  - [ ] 请求解释概念--"你能解释一下什么是导数吗？"
  - [ ] 选择句--"你想先深入学习哪个主题-极限、导数还是积分"
  - [ ] 自我评价句--"你觉得自己在使用AI时，独立思考的频率如何？"
  - [ ] 表态句--"你是否愿意尝试设定思考时间这个建议？"
  - [ ] 希望提供更多信息问句-"在用户体验方面，你觉得还有哪些重要的考虑因素？"

### 下一步任务
- [ ] 完善answer卡片的填充功能
- [ ] 实现针对不同问题类型的回答模板
- [ ] 添加answer的状态值显示（回答中/已完成）
- [ ] 提高ai提问的技术含量
- [ ] 研究使用更快速的ai模型来做问题总结
- [ ] 优化问题卡片的加载和内容填充机制

## 2025年2月20日
### 完成的内容
- [x] 调整了AgentModel.js，可以在创建的时候自定义端点和key值，进一步定义不同类型和需求的agent
- [x] 研究使用更快速的ai模型来做问题总结，用上面的快速切换可以测试，目前用glm-4-air来总结

### 问题
- [ ] 使用单一的回答模板，不能做出合适的回答，对于不同情况的问题，仅仅靠"5种掌握程度"不能做出合适的回答。可能需要根据不同的问题来区分

### 下一步任务
- [ ] 完善answer卡片的填充功能
- [ ] 添加answer的状态值显示（回答中/已完成）
  - [ ] 检测回答状态
    - [ ] 检测回答是否开始
    - [ ] 检测回答是否完成
  - [ ] 解析器处理
    - [ ] 回答完成即解析完成
    - [ ] 非流解析器增加回调函数
    - [ ] 统一成流解析器(❕纳入计划)
  - [x] AI回答流程状态
    - [x] 发送请求
    - [x] 开始回答
    - [x] 回答完毕
    - [x] 可修改AgentModel回调函数来设置状态值
- [ ] 实现针对不同问题类型的回答模板
- [ ] 提高ai提问的技术含量
- [ ] 优化问题卡片的加载和内容填充机制

## 2025年2月21日
### 完成的内容
- [x] 为AgentModel添加了回调函数
  - [x] 发送请求
  - [x] 开始回答
  - [x] 回答完毕
  - [x] 可修改AgentModel回调函数来设置状态值
- [x] 为问题卡片添加了状态相应值，更符合人机交互了
- [x] 聊天气泡中的问题不必忽视，也可以显示，把question标签的内容也添加到了气泡中
- [x] 为Question的内容做了区分
- [x] 为QuestionCard添加了回答时禁用状态
- [x] 通过给questionCard添加状态值和置灰操作来避免进入answerCard这个页面来解决这个问题
- [x] 为AnswerCard添加了预测回答失败的内容
- [x] 增加了云雾api的gemini、grok、ds-v3模型
- [x] 把markdown渲染器从MessageBubble中移除，并添加了MarkdownRenderer组件
- [x] 把agent的创建移除到了agents.js中，并添加了createMainAgent和createOptionAgent函数
- [x] 把chatWindow中的消息气泡组件替换为MessageBubble组件
- [x] 为MessageBubble添加了复制按钮
- [x] 为MarkdownRenderer添加了行内公式和行间公式的渲染
- [x] 修改了question的逻辑，现在question可以在行内存在了
- [x] 修改了prompt，现在prompt中添加了行内公式和行间公式的输出格式指定
- [x] 增加了问题卡片和回答卡片总markdown格式的渲染
- [x] 把原来的xml标签更换成了冷门的"〖"符号，解决了生成内容中有"<"的渲染问题，可以写html代码了

### 问题
- [ ] ui有问题
  - [ ] questionCard总会莫名其妙地变高
  - [ ] 调整滑动条，滑动条不好看
  - [ ] 页面只有中心部分有用，两侧的空白部分太多，显得非常单调
- [ ] 缺乏一个管理baseURL和apiKey的页面或者说组件--可能要重构逻辑
- [ ] 缺乏设置agent的组件，设置mainAgent和optionAgent的组件
- [ ] 缺乏一个设置prompt的组件
- [ ] 缺乏专门的回答卡片，气泡组件不够好看不够有造型
- [x] 把api换成gemini以后，发现如果mainAgent生成内容过快，会把ui-messages中断，同时也会将optionAgent调用请求打断

### 下一步任务
- [ ] 实现针对不同问题类型的回答模板
- [ ] 提高ai提问的技术含量
- [ ] 优化问题卡片的加载和内容填充机制

## 2025年2月22日
### 完成的内容
- [x] 添加了一个开场提示词组件，便于调试

### 下一步任务
- [ ] 解决问题卡片在白天主题时的ui问题
- [ ] 解决mainAgent生成内容过快，会把ui-messages中断，同时也会将optionAgent调用请求打断的问题-很重要
  - [ ] 可以在agentModel中限制输出的速度上线
  - [ ] 理清更新的逻辑，然后修改

## 2025年2月23日
### 完成的内容
- [x] 添加了Grok的api，通过服务器进行转发，应该是要求要用美国ip才可以
- [x] 解决了之前的中断ui-messages的问题，其实不是因为生成内容过快产生的，是因为解析器内部有异步函数导致的回调函数触发不了的原因
- [x] 修改了快速提示词
- [x] 修改了选项ai调用的逻辑，现在更合理了
- [x] 添加了一个回答卡片界面回车发送的快捷键

### 问题
- [ ] ui有问题
  - [ ] questionCard总会莫名其妙地变高
  - [ ] 调整滑动条，滑动条不好看
  - [ ] 页面只有中心部分有用，两侧的空白部分太多，显得非常单调
- [ ] 缺乏一个管理baseURL和apiKey的页面或者说组件--可能要重构逻辑
- [ ] 缺乏设置agent的组件，设置mainAgent和optionAgent的组件
- [ ] 缺乏一个设置prompt的组件
- [ ] 缺乏专门的回答卡片，气泡组件不够好看不够有造型
- [x] 把api换成gemini以后，发现如果mainAgent生成内容过快，会把ui-messages中断，同时也会将optionAgent调用请求打断
- [ ] 模型智能不够时，如果输出过长，会出现不遵循提示词，不用标签包裹代码的情况

### 下一步任务
- [ ] 解决问题卡片在白天主题时的ui问题
- [x] 解决mainAgent生成内容过快，会把ui-messages中断，同时也会将optionAgent调用请求打断的问题-很重要
  - [ ] 可以在agentModel中限制输出的速度上线
  - [ ] 理清更新的逻辑，然后修改

## 2025年2月28日
### 完成的内容
- [x] 注释了两个装饰元素，解决了ui问题
- [x] 解决ui问题
- [x] 修改了答案卡片的不同等级配色
- [x] 添加了答案模糊效果，hover过后才会展示答案
- [x] 添加了一个标语"答案在终点，思考即旅程"

### 问题
- [x] ui有问题
  - [x] questionCard总会莫名其妙地变高
  - [x] 调整滑动条，滑动条不好看
  - [x] 页面只有中心部分有用，两侧的空白部分太多，显得非常单调
- [ ] 缺乏一个管理baseURL和apiKey的页面或者说组件--可能要重构逻辑
- [ ] 缺乏设置agent的组件，设置mainAgent和optionAgent的组件
- [ ] 缺乏一个设置prompt的组件
- [ ] 缺乏专门的回答卡片，气泡组件不够好看不够有造型
- [x] 把api换成gemini以后，发现如果mainAgent生成内容过快，会把ui-messages中断，同时也会将optionAgent调用请求打断
- [ ] 模型智能不够时，如果输出过长，会出现不遵循提示词，不用标签包裹代码的情况

### 下一步任务
- [ ] 修改回答卡片的ui显示逻辑，使得其可以在界面中成为卡片的形式，可以被拖动，同时不影响查看对话历史
- [ ] 对于问题卡片，可以让用户自己选择叉掉某个问题，这样让问题取消，可以自己修改提问的方向

## 2025年3月1日
### 完成的内容
- [x] 问题卡片添加了一个问题的取消按钮，可以取消问题->叉掉回答

### 问题
- [ ] 消息中，question部分的内容公式没有markdown格式
- [ ] 回答问题达到3个的时候好像会无限循环地问问题，只要有两个以上就会，应该是状态值更新的问题
- [ ] 缺乏一个管理baseURL和apiKey的页面或者说组件--可能要重构逻辑
- [ ] 缺乏设置agent的组件，设置mainAgent和optionAgent的组件
- [ ] 缺乏一个设置prompt的组件
- [ ] 缺乏专门的回答卡片，气泡组件不够好看不够有造型

### 下一步任务
- [ ] 优化回答卡片的界面展示逻辑，使其呈现为可拖动的卡片形式，同时保持对话历史的可查看性
- [ ] 修复回答问题达到3个的时候无限循环的问题

## 2025年3月2日
### 完成的内容
- [x] 优化回答卡片的界面展示逻辑，使其呈现为可拖动的卡片形式，同时保持对话历史的可查看性
- [x] 修复回答问题达到3个的时候无限循环的问题
- [x] 修复了消息气泡中question部分的内容公式没有markdown格式的问题

### 问题
- [ ] 缺乏一个管理baseURL和apiKey的页面或者说组件--可能要重构逻辑
- [ ] 缺乏设置agent的组件，设置mainAgent和optionAgent的组件
- [ ] 缺乏一个设置prompt的组件
- [ ] 缺乏专门的回答卡片，气泡组件不够好看不够有造型

### 下一步任务
- [ ] 研究一下怎么使用vercel部署或者在服务器部署
- [ ] 修改管理api的方式，修改成用后端服务器来管理

## 2025年3月3日
### 完成的内容
- [x] 在vercel上部署了wenzhixuan.com
- [x] 修改了提示词，提供更好的交互性

### 问题
- [ ] 缺乏一个管理baseURL和apiKey的页面或者说组件--可能要重构逻辑
- [ ] 缺乏设置agent的组件，设置mainAgent和optionAgent的组件
- [ ] 缺乏一个设置prompt的组件
- [ ] 缺乏专门的回答卡片，气泡组件不够好看不够有造型

### 下一步任务
- [ ] 修改管理api的方式，修改成用后端服务器来管理
- [x] 增加一个面板来管理api-key和baseurl

## 2025年3月4日
### 完成的内容
- [x] 添加了一个简单的面板可以快速调整api和模型
- [x] 可以点击按钮重新回答问题了
- [x] 更改了一个回答卡片的样式，添加了问题和回答的标题

### 问题
- [ ] 缺乏设置agent的组件，设置mainAgent和optionAgent的组件
- [ ] 缺乏一个设置prompt的组件
- [ ] 缺乏专门的回答卡片，气泡组件不够好看不够有造型

### 下一步任务
- [ ] 修改管理api的方式，修改成用后端服务器来管理
- [ ] 添加一个提示“回答被截断”的功能，提示用户重试

## 2025年3月5日
### 完成的内容
- [x] 优化了布局

### 问题
- [ ] 缺乏一个管理baseURL和apiKey的页面或者说组件--可能要重构逻辑
- [ ] 缺乏设置agent的组件，设置mainAgent和optionAgent的组件
- [ ] 缺乏一个设置prompt的组件
- [ ] 回答卡片的位置出问题了

### 下一步任务
- [ ] 修改管理api的方式，修改成用后端服务器来管理
- [ ] 添加一个提示“回答被截断”的功能，提示用户重试

## 2025年3月6日
### 完成的内容
- [x] 修复了回答卡片的位置问题
- [x] 左中右三栏可以拖动了
- [x] 修复卡片背景遮罩阻挡交互的bug
- [x] 可以拖拽来调整回答卡片的大小

## 2025年3月7日
## 问题
- [ ] api控制面板大小问题
- [ ] api实际上不能自由选择使用openai格式的方式
- [ ] 提示词管理
  - [ ] 把“熟悉”程度的5个等级改成通用的问题回答方式
  - [ ] 如何识别不同问题场景，选用不同的提示词？解析不同的内容来针对回答？
    - [ ] 使用单一的回答模板，不能做出合适的回答，对于不同情况的问题，仅仅靠"5种掌握程度"不能做出合适的回答。可能需要根据不同的问题来区分
      - [ ] 疑问句--提出几个概念，询问是否了解
      - [ ] 是否有兴趣--"你是否有兴趣了解高数中的某个具体主题，比如极限、导数或者积分？"
      - [ ] 请求解释概念--"你能解释一下什么是导数吗？"
      - [ ] 选择句--"你想先深入学习哪个主题-极限、导数还是积分"
      - [ ] 自我评价句--"你觉得自己在使用AI时，独立思考的频率如何？"
      - [ ] 表态句--"你是否愿意尝试设定思考时间这个建议？"
      - [ ] 希望提供更多信息问句-"在用户体验方面，你觉得还有哪些重要的考虑因素？"

### 完成的内容
- [x] 优化了api控制面板的大小问题
- [x] 新建本地存储分支
- [x] 优化api管理面板，可以自定义接口和模型了
- [x] 添加浏览器本地存储的逻辑
- [x] 添加了历史记录功能
- [x] 添加了修改提示词功能
- [x] 调整了一大堆ui界面
- [x] 修改历史记录逻辑
- [x] 增强“问题卡片”逻辑
- [x] 修改了回答消息卡片的样式，可以折叠了，交互性更好
- [x] 修改了几个不同理解层次的表述

## 2025年3月9日

### 完成的内容
- [x] 修复了问题卡片缺少"取消"按钮的问题
- [x] 优化了"发送"按钮的样式
- [x] 将"快速开始"功能与新建对话进行了绑定
- [x] 修复了回答卡片的"回车"发送消息被拦截的问题
- [x] 优化了用户气泡的样式,采用了更简洁、更浅的色调,移除了渐变效果
- [x] 修复“快速开始”的ui问题
- [x] 修改回答卡片面板的ui
- [x] 删除大部分与主题相关的冗余代码
- [x] 修改了启动页面的问候排版

### 问题
- [ ] 模型切换面板的逻辑还有点问题，同时保存的提示反馈不足
- [ ] 初始api使用不了，需要在面板中修改过后才可以使用
- [ ] 获得问题的时候，不添加问题和等级到messages中，不然会有幻觉
- [ ] 目前如果ai的回复失败，没有错误提示，并且不可以重试
- [ ] 问题卡片的颜色需要修改-和ai回答匹配
- [ ] 问题分块儿的逻辑有问题，目前会不按照标签分块儿
- [ ] loading动画太低级了，整个高级点的
- [ ] 回答卡片点击按钮发送缺失

## 2025年3月15日
### 完成的内容
- [x] 修改了一下提示词，但是好像不太能遵循效果
- [x] 美化了一下loading动画  
### 问题
- [ ] 初始api使用不了，需要在面板中修改过后才可以使用
  - [ ] 初始api可以用了，但是localStorage用不了，需要学习和分析文件，到底该怎么调整！！！
- [ ] 模型切换面板的逻辑还有点问题，同时保存的提示反馈不足
- [ ] 获得问题的时候，不添加问题和等级到messages中，不然会有幻觉
- [ ] 目前如果ai的回复失败，没有错误提示，并且不可以重试
- [ ] 问题卡片的颜色需要修改-和ai回答匹配
- [ ] 问题分块儿的逻辑有问题，目前会不按照标签分块儿
- [ ] 回答卡片点击按钮发送缺失

## 2025年3月16日
### 完成的内容
- [x] 添加了一个调试面板可以查看当前模型配置和提示词
- [x] 聊天记录导出和清空功能
- [x] 解决了api初始配置的问题
- [x] 把设置面板、历史记录 面板等从chatpage分离
- [x] 优化设置面板的一些细节，设计了提示词隐藏
- [x] 优化设置面板颜色

## 2025年3月17日
### 完成的内容
- [x] 添加开发者模式
- [x] 修改vercel配置
- [x] 调整提示词，但是功效不大，很多模型在格式遵循方面还是很欠缺
- [x] 添加提示语
- [x] 添加了“关于”页面
- [x] 添加部分双语支持
  - [x] welcomeScreen完成
  - [x] HeaderButtons完成
  - [x] ChatLayout完成
  - [x] ChatWindow完成  
  - [x] MessageBubble完成
  - [x] HistorySidebar完成
  - [x] ChatPage完成
  - [x] QuestionCard完成
  - [x] AnswerMessageCard完成
- [x] 修改answerCard的布局
- [x] 略微修改提示词

## 2025年3月18日
### 完成的内容
- [x] 删去调试信息
- [x] 回答面板的点击发送按钮 
- [x] 设置一个开关可以关闭等待状态
- [x] 回答卡片初始大小
- [x] 添加了一个landing page
- [x] 增加了语言切换选项ai的提示词的功能，避免出现语言不统一的问题

## 2025年3月19日
### 完成的内容
- [x] 进一步优化双语提示词

